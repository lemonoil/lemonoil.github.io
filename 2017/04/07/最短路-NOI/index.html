<!DOCTYPE html>
<html>
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta name="baidu-site-verification" content="S5bJxhjLWN" />
    

    <title>
      最短路---NOI | lemonoil 
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="lemonoil">
    
    

    <meta name="description" content="最短路径(shortest)

256MB 1seconds
【题目描述】
给定无向图，包含n个顶点，m条无向边，边上有权值。从1号点出发不经过i号点到达n号点的最短路径计作di，求d2..dn-1。
【输入格式】
第一行两个正整数n，m，表示点的数量和边的数量。
随后m行，每行三个正整数x、y、z，表示x到y的边权值为z。
【输出格式】
仅一行，包含n-2个整数，依次为d2..dn-1。
【">
<meta property="og:type" content="article">
<meta property="og:title" content="最短路---NOI | lemonoil">
<meta property="og:url" content="https://lemonoil.github.io/2017/04/07/最短路-NOI/index.html">
<meta property="og:site_name" content="lemonoil">
<meta property="og:description" content="最短路径(shortest)

256MB 1seconds
【题目描述】
给定无向图，包含n个顶点，m条无向边，边上有权值。从1号点出发不经过i号点到达n号点的最短路径计作di，求d2..dn-1。
【输入格式】
第一行两个正整数n，m，表示点的数量和边的数量。
随后m行，每行三个正整数x、y、z，表示x到y的边权值为z。
【输出格式】
仅一行，包含n-2个整数，依次为d2..dn-1。
【">
<meta property="og:image" content="http://gf.ppgame.com/CKFinderJava/1/files/1%20(1).jpg">
<meta property="og:image" content="http://gf.ppgame.com/CKFinderJava/1/files/1%20(2).png">
<meta property="og:image" content="http://gf.ppgame.com/CKFinderJava/1/files/1%20(1).png">
<meta property="og:updated_time" content="2017-04-06T16:46:56.952Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="最短路---NOI | lemonoil">
<meta name="twitter:description" content="最短路径(shortest)

256MB 1seconds
【题目描述】
给定无向图，包含n个顶点，m条无向边，边上有权值。从1号点出发不经过i号点到达n号点的最短路径计作di，求d2..dn-1。
【输入格式】
第一行两个正整数n，m，表示点的数量和边的数量。
随后m行，每行三个正整数x、y、z，表示x到y的边权值为z。
【输出格式】
仅一行，包含n-2个整数，依次为d2..dn-1。
【">
<meta name="twitter:image" content="http://gf.ppgame.com/CKFinderJava/1/files/1%20(1).jpg">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.gif">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">
	<script>
	(function(){
		var bp = document.createElement('script');
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https') {
			bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
		}
		else {
			bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		}
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	})();
	</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">

  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=260 height=400 src="//music.163.com/outchain/player?type=0&id=2206964132&auto=1&height=430"></iframe>
	<div class="panel-main__content">
        
        <a href="/" title="link to homepage for lemonoil"><img src="/avatar.png" width="80" alt="lemonoil logo" class="panel-cover__logo logo" /></a>
        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">lemonoil</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          OI__nothing is impossible
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">首页</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">关于</a></li>
              
                
                <li class="navigation__item"><a href="/archives" title="" class="">归档</a></li>
              

            </ul>
          </nav>

          <!-- add social info here -->



<nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
      <!-- Github -->
      <li class="navigation__item">
        <a href="https://github.com/lemonoil" title="Huno on GitHub">
          <i class='icon icon-social-github'></i>
          <span class="label">GitHub</span>
        </a>
      </li>
    

    <li class="navigation__item">
        <a href="https://blog.csdn.net/lemonoil" title="another blog">
          <i>
            <img src="https://raw.githubusercontent.com/lemonoil/README-ans-REMEMBER-me/master/csdnl.png">
            </i>
          <span class="label">CSDN</span>
        </a>
      </li>
  </ul>
</nav>




        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

	
    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">

    <h1 class="post-title">最短路---NOI</h1>

    

    <div class="post-meta">
      <time datetime="2017-04-07" class="post-meta__date date">2017-04-07</time> 

      <span class="post-meta__tags tags">

          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/最短路-NOI/">最短路 NOI</a>
            </font>
          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><h1>最短路径(shortest)</h1>
<p><img src="http://gf.ppgame.com/CKFinderJava/1/files/1%20(1).jpg" alt=""></p>
<p>256MB 1seconds
【题目描述】
给定无向图，包含n个顶点，m条无向边，边上有权值。从1号点出发不经过i号点到达n号点的最短路径计作di，求d2..dn-1。
【输入格式】
第一行两个正整数n，m，表示点的数量和边的数量。
随后m行，每行三个正整数x、y、z，表示x到y的边权值为z。
【输出格式】
仅一行，包含n-2个整数，依次为d2..dn-1。
【输入样例】
4 4
1 2 1
1 3 1
2 4 2
3 4 1
【输出样例】
2 3
【数据规模与约定】
对于100%的数据，n, m&lt;=200000。</p>
<h2>题解</h2>
<p>如果考试的话，我<strong>绝壁</strong>写个SPFA大暴力，最多改写手写循环队列，了事。orz wxh大佬。。。。
自己的大暴力。。。。
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rez(i,x,y) for(int i=x;i&gt;=y;i--)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> res(i,x,y) for(int i=x;i&lt;=y;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2100000000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> clr(x)  memset(x,0,sizeof(x))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"ans"</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readin</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> res,flag=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)res=ch<span class="number">-48</span>+res*<span class="number">10</span>;res*=flag;</div><div class="line">	<span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="keyword">struct</span> Edge&#123;</div><div class="line">	<span class="keyword">int</span> from,to,dist;</div><div class="line">	Edge(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> d):from(u),to(v),dist(d)&#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">200000</span>;</div><div class="line"><span class="keyword">struct</span> SPFA&#123;</div><div class="line">	<span class="keyword">int</span> n,m;</div><div class="line">	<span class="built_in">vector</span>&lt;Edge&gt; edges;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[maxn];</div><div class="line">	<span class="keyword">bool</span> done[maxn];</div><div class="line">	<span class="keyword">int</span> d[maxn];</div><div class="line">	<span class="keyword">int</span> p[maxn];</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</div><div class="line">		<span class="keyword">this</span>-&gt;n=n;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)G[i].clear();</div><div class="line">		edges.clear();</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from,<span class="keyword">int</span> to,<span class="keyword">int</span> dist)</span></span>&#123;</div><div class="line">		edges.push_back(Edge(from,to,dist));</div><div class="line">		m=edges.size();</div><div class="line">		G[from].push_back(m<span class="number">-1</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddDedge</span><span class="params">(<span class="keyword">int</span> from,<span class="keyword">int</span> to,<span class="keyword">int</span> dist)</span></span>&#123;</div><div class="line">		edges.push_back(Edge(from,to,dist));</div><div class="line">		m=edges.size();</div><div class="line">		G[from].push_back(m<span class="number">-1</span>);</div><div class="line">		edges.push_back(Edge(dist,to,from));</div><div class="line">		m=edges.size();</div><div class="line">		G[dist].push_back(m<span class="number">-1</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</div><div class="line">		<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</div><div class="line">		<span class="built_in">memset</span>(done,<span class="number">0</span>,<span class="keyword">sizeof</span>(done));	</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)d[i]=INF;</div><div class="line">		d[s]=<span class="number">0</span>;</div><div class="line">		done[s]=<span class="number">1</span>;</div><div class="line">		Q.push(s);</div><div class="line">		<span class="keyword">while</span>(!Q.empty())&#123;</div><div class="line">			<span class="keyword">int</span> u=Q.front();Q.pop();</div><div class="line">			done[u]=<span class="number">0</span>;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;G[u].size();i++)&#123;</div><div class="line">				Edge&amp; e=edges[G[u][i]];</div><div class="line">				<span class="keyword">if</span>(d[u]&lt;INF&amp;&amp;d[e.to]&gt;d[u]+e.dist)&#123;</div><div class="line">					d[e.to]=d[u]+e.dist;</div><div class="line">					p[e.to]=G[u][i];</div><div class="line">					<span class="keyword">if</span>(!done[e.to])&#123;</div><div class="line">						Q.push(e.to);</div><div class="line">						done[e.to]=<span class="number">1</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">spfas</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</div><div class="line">		<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</div><div class="line">		<span class="built_in">memset</span>(done,<span class="number">0</span>,<span class="keyword">sizeof</span>(done));	</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=n;i++)d[i]=INF;</div><div class="line">		d[<span class="number">1</span>]=<span class="number">0</span>;</div><div class="line">		done[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">		Q.push(<span class="number">1</span>);</div><div class="line">		<span class="keyword">while</span>(!Q.empty())&#123;</div><div class="line">			<span class="keyword">int</span> u=Q.front();Q.pop();</div><div class="line">			done[u]=<span class="number">0</span>;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;G[u].size();i++)&#123;</div><div class="line">				Edge&amp; e=edges[G[u][i]];</div><div class="line">				<span class="keyword">if</span>(e.to!=s&amp;&amp;d[u]&lt;INF&amp;&amp;d[e.to]&gt;d[u]+e.dist)&#123;</div><div class="line">					d[e.to]=d[u]+e.dist;</div><div class="line">					p[e.to]=G[u][i];</div><div class="line">					<span class="keyword">if</span>(!done[e.to])&#123;</div><div class="line">						Q.push(e.to);</div><div class="line">						done[e.to]=<span class="number">1</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line">SPFA slover;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	n=readin(),m=readin();</div><div class="line">	slover.init(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</div><div class="line">		slover.AddDedge(readin(),readin(),readin());</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">2</span>;i&lt;n;i++)</div><div class="line">		slover.spfas(i),<span class="built_in">cout</span>&lt;&lt;slover.d[n]&lt;&lt;<span class="string">' '</span>;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>fastest正解
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200100</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> lld long long</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> lld inf = <span class="number">1e18</span>;</div><div class="line"><span class="keyword">struct</span> edge&#123;</div><div class="line">	<span class="keyword">int</span> u,np,next,va;</div><div class="line">	<span class="keyword">bool</span> mark;</div><div class="line">&#125;e[maxn*<span class="number">2</span>];</div><div class="line"><span class="keyword">int</span> head[maxn];</div><div class="line"><span class="keyword">int</span> e_cnt = <span class="number">1</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add_e</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> va)</span></span>&#123;</div><div class="line">	e[++e_cnt] = (edge)&#123;u,v,head[u],va,<span class="number">0</span>&#125;;</div><div class="line">	head[u] = e_cnt;</div><div class="line">	e[++e_cnt] = (edge)&#123;v,u,head[v],va,<span class="number">0</span>&#125;;</div><div class="line">	head[v] = e_cnt;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line">lld dis[maxn],dis_n[<span class="number">2</span>][maxn];</div><div class="line"><span class="keyword">int</span> ide[maxn];</div><div class="line"><span class="keyword">bool</span> inq[maxn];</div><div class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; qx;</div><div class="line"><span class="keyword">int</span> co[maxn],co_mx;</div><div class="line"><span class="keyword">int</span> fa[maxn];</div><div class="line">lld anss[maxn];</div><div class="line"><span class="keyword">bool</span> isva[maxn];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> ne = head[x];ne;ne = e[ne].next)&#123;</div><div class="line">		<span class="keyword">if</span>(!e[ne].mark || e[ne].np == fa[x]) <span class="keyword">continue</span>;</div><div class="line">		fa[e[ne].np] = x;</div><div class="line">		<span class="keyword">if</span>(!co[e[ne].np]) co[e[ne].np] = co[x];</div><div class="line">		dfs(e[ne].np);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">struct</span> dat&#123;</div><div class="line">	<span class="keyword">int</span> l,r;</div><div class="line">	lld va;</div><div class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> dat&amp; x) <span class="keyword">const</span>&#123;</div><div class="line">		<span class="keyword">return</span> va &lt; x.va;</div><div class="line">	&#125;</div><div class="line">&#125;dt[maxn];</div><div class="line"><span class="keyword">int</span> dt_ct = <span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> pre[maxn];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">getp</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> x == pre[x]?x:(pre[x]=getp(pre[x]));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=n;++i) anss[i] = dis_n[<span class="number">0</span>][i] = dis_n[<span class="number">1</span>][i] = dis[i] = inf;</div><div class="line">	dis[<span class="number">1</span>] = <span class="number">0</span>;</div><div class="line">	qx.push(<span class="number">1</span>);</div><div class="line">	<span class="keyword">while</span>(!qx.empty())&#123;</div><div class="line">		<span class="keyword">int</span> now = qx.front();</div><div class="line">		qx.pop();</div><div class="line">		inq[now] = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> ne = head[now];ne;ne = e[ne].next)&#123;</div><div class="line">			<span class="keyword">int</span> cur = e[ne].np;</div><div class="line">			<span class="keyword">if</span>(dis[cur] &gt; dis[now] + e[ne].va)&#123;</div><div class="line">				dis[cur] = dis[now] + e[ne].va;</div><div class="line">				ide[cur] = ne;</div><div class="line">				<span class="keyword">if</span>(!inq[cur]) inq[cur]=<span class="number">1</span>,qx.push(cur);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	co_mx = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> k = ide[n];k;k = ide[e[k].u]) ++co_mx;</div><div class="line">	co[n] = co_mx+<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> k = ide[n];k;k = ide[e[k].u]) isva[e[k].u] = <span class="number">1</span>,co[e[k].u] = co_mx--;</div><div class="line">	co_mx = co[n];</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;++i) e[ide[i]].mark = e[ide[i] ^ <span class="number">1</span>].mark = <span class="number">1</span>;	</div><div class="line">	dfs(<span class="number">1</span>);</div><div class="line">	dis_n[<span class="number">0</span>][n] = <span class="number">0</span>;</div><div class="line">	qx.push(n);</div><div class="line">	<span class="keyword">while</span>(!qx.empty())&#123;</div><div class="line">		<span class="keyword">int</span> now = qx.front();</div><div class="line">		qx.pop();</div><div class="line">		inq[now] = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> ne = head[now];ne;ne=e[ne].next)&#123;</div><div class="line">			<span class="keyword">int</span> cur = e[ne].np;</div><div class="line">			<span class="keyword">bool</span> fg = <span class="number">0</span>;</div><div class="line">			<span class="keyword">if</span>(dis_n[<span class="number">0</span>][cur] &gt; dis_n[<span class="number">0</span>][now] + e[ne].va)&#123;</div><div class="line">				dis_n[<span class="number">0</span>][cur] = dis_n[<span class="number">0</span>][now] + e[ne].va;</div><div class="line">				fg = <span class="number">1</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(!isva[cur])&#123;</div><div class="line">				<span class="keyword">if</span>(co[cur] == co[now])&#123;</div><div class="line">					<span class="keyword">if</span>(dis_n[<span class="number">1</span>][cur] &gt; dis_n[<span class="number">1</span>][now] + e[ne].va)&#123;</div><div class="line">						dis_n[<span class="number">1</span>][cur] = dis_n[<span class="number">1</span>][now] + e[ne].va;</div><div class="line">						fg = <span class="number">1</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(co[cur] &lt; co[now])&#123;</div><div class="line">					<span class="keyword">if</span>(dis_n[<span class="number">1</span>][cur] &gt; dis_n[<span class="number">0</span>][now] + e[ne].va)&#123;</div><div class="line">						dis_n[<span class="number">1</span>][cur] = dis_n[<span class="number">0</span>][now] + e[ne].va;</div><div class="line">						fg = <span class="number">1</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(fg &amp;&amp; !inq[cur]) inq[cur] = <span class="number">1</span>,qx.push(cur);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	dis_n[<span class="number">1</span>][n] = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= e_cnt;++i)&#123;</div><div class="line">		<span class="keyword">if</span>(e[i].mark) <span class="keyword">continue</span>;</div><div class="line">		<span class="keyword">int</span> u = e[i].u,v = e[i].np,va = e[i].va;</div><div class="line">		<span class="keyword">if</span>(co[u]+<span class="number">1</span> &lt;= co[v]<span class="number">-1</span>) dt[++dt_ct] = (dat)&#123;co[u]+<span class="number">1</span>,co[v]<span class="number">-1</span>,dis_n[<span class="number">0</span>][v]+va+dis[u]&#125;;</div><div class="line">		<span class="keyword">if</span>(co[u]+<span class="number">1</span> &lt;= co[v]) anss[co[v]] = min(anss[co[v]],dis_n[<span class="number">1</span>][v]+va+dis[u]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=co_mx+<span class="number">1</span>;++i) pre[i] = i;</div><div class="line">	sort(dt+<span class="number">1</span>,dt+<span class="number">1</span>+dt_ct);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=dt_ct;++i)&#123;</div><div class="line">		<span class="keyword">int</span> l = dt[i].l,r = dt[i].r;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> nxt = getp(l);nxt &lt;= r;)&#123;</div><div class="line">			anss[nxt] = min(anss[nxt],dt[i].va);</div><div class="line">			pre[nxt] = nxt+<span class="number">1</span>;</div><div class="line">			nxt = getp(nxt+<span class="number">1</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n<span class="number">-1</span>;++i)&#123;</div><div class="line">		<span class="keyword">if</span>(!isva[i]) <span class="built_in">printf</span>(<span class="string">"%lld "</span>,dis[n]);</div><div class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%lld "</span>,anss[co[i]]);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> a1,a2,a3;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(<span class="string">"shortest.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"shortest.ans"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=m;++i)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;a1,&amp;a2,&amp;a3);</div><div class="line">		add_e(a1,a2,a3);</div><div class="line">	&#125;</div><div class="line">	solve();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1>第一视角(blind)</h1>
<p><img src="http://gf.ppgame.com/CKFinderJava/1/files/1%20(2).png" alt="">
【问题描述】
QQ：我来给你出道题！给定一个有向图，包含n个点（编号1至n）和m条边，求1号点到2号点的最短路。
你：这个问题太简单了，……
QQ：我们增加一些难度，这m条边中有一条指定的边坏掉了，它不能经过。问这种情况下1号点到2号点的最短路。
你：直接把坏掉的那条边删掉，然后再求最短路不就好了。问题似乎没有变难呀！
QQ：这是由于你开了“上帝视角”，你知道哪条边是坏的，当然简单了！如果你是以“第一视角”去寻找最短路，换句话讲，最初你并不知道哪条边是坏的，只有走到“坏边”的起点后，才知道这条边是不能通过的。这种情况下，你要从1号点走到2号点，最少要走多少距离呀。
你：那当然要看是哪条边坏掉啦！不同的边坏掉答案是不一样的。
QQ：那……你帮我算算，最坏情况下需要走多远。
你：好的！马上就去写程序！
【输入格式】
第一行包含两个正整数n、m，分别表示点数和边数。
随后m行，每行三个正整数x、y、w，表示有一条从x到y的有向边，距离为w。
【输出格式】
仅一行，包含一个正整数，表示最坏情况下需要走多少距离。若不能到达，输出-1。
【样例输入】
4 6
1 3 1
1 4 1
3 1 5
4 1 10
3 2 3
4 2 2
【样例输出】
9
【样例说明】
首先给出一种错误的思路：
假设边（1-3）坏了，最短路是1-4-2，距离为3；
假设边（1-4）或（4-2）坏了，最短路是1-3-2，距离为4；
假设边（3-1）或（4-1）或（3-2）坏了，最短路仍为1-4-2，距离为3；
综上，最坏情况下最短路是4。
这种思路的错误在于仍然开启了“上帝视角”。换句话讲，它的决策是基于已知哪条边坏掉的。具体地讲，当我站在1号点时并不能确定边（3-2）和边（4-2）中哪条边坏了，此时我必须决定走（1-3）还是（1-4），而不是根据（3-2）和（4-2）哪条坏了这个信息决定走向3还是走向4。
下面介绍正确思路。首先站在1号点，确认（1-3）有没有坏。如果（1-3）坏了，直接走1-4-2到达终点，距离仅为3。如果（1-3）没坏，先从1走到3。此时站在3，确认（3-2）有没有坏。如果（3-2）坏了，则从3回到1再经过4最终到达2，整个路径为1-3-1-4-2，距离为9；如果（3-2）没坏，则整个路径为1-3-2，距离为4。综上最坏情况下距离为9。
另一种方法是先确认（1-4）有没有坏，如果坏了走1-3-2，如果没坏就走到2再确认（2-4）有没有坏。这种方法最差的可能是1-4-1-3-2，距离为15，不如上一个方法。
【数据规模与约定】
对于20%的数据，n&lt;=5；
对于30%的数据，n&lt;=10；
对于50%的数据，n&lt;=20；
对于100%的数据，n&lt;=100, m&lt;=500, 边的距离不超过1000。</p>
<p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">struct</span> Edge &#123;</div><div class="line">    <span class="keyword">int</span> y, w, next;</div><div class="line">&#125; <span class="built_in">map</span>[<span class="number">1010</span>];</div><div class="line"><span class="keyword">int</span> num = <span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> d[<span class="number">110</span>], know[<span class="number">110</span>], head[<span class="number">110</span>], head1[<span class="number">110</span>], flag[<span class="number">110</span>], dis[<span class="number">501</span>][<span class="number">110</span>], dis0[<span class="number">110</span>];</div><div class="line"><span class="keyword">int</span> n, m;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">newedge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w, <span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">    <span class="built_in">map</span>[c].y = y;</div><div class="line">    <span class="built_in">map</span>[c].w = w;</div><div class="line">    <span class="built_in">map</span>[c].next = head[x];</div><div class="line">    head[x] = c;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">newedge1</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w, <span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">    <span class="built_in">map</span>[c].y = y;</div><div class="line">    <span class="built_in">map</span>[c].w = w;</div><div class="line">    <span class="built_in">map</span>[c].next = head1[x];</div><div class="line">    head1[x] = c;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    freopen(<span class="string">"blind.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">    freopen(<span class="string">"blind.ans"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) &#123;</div><div class="line">        head[i] = <span class="number">-1</span>;</div><div class="line">        head1[i] = <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;m; i++) &#123;</div><div class="line">        <span class="keyword">int</span> x, y, w;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;x, &amp;y, &amp;w);</div><div class="line">        newedge(x, y, w, i);</div><div class="line">        newedge1(y, x, w, i+m);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;m; k++) &#123;</div><div class="line">        <span class="keyword">int</span> st = <span class="number">0</span>, ed = <span class="number">1</span>;</div><div class="line">        d[<span class="number">0</span>] = <span class="number">2</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) flag[i] = <span class="literal">true</span>;</div><div class="line">        flag[<span class="number">2</span>] = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) dis[k][i] = <span class="number">9999999</span>;</div><div class="line">        dis[k][<span class="number">2</span>] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (st &lt; ed) &#123;</div><div class="line">            <span class="keyword">int</span> i = d[(st++) % n];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=head1[i]; j&gt;<span class="number">-1</span>; j=<span class="built_in">map</span>[j].next) &#123;</div><div class="line">                <span class="keyword">if</span> (j == k+m) <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">if</span> (dis[k][i] + <span class="built_in">map</span>[j].w &lt; dis[k][<span class="built_in">map</span>[j].y]) &#123;</div><div class="line">                    dis[k][<span class="built_in">map</span>[j].y] = dis[k][i] + <span class="built_in">map</span>[j].w;</div><div class="line">                    <span class="keyword">if</span> (flag[<span class="built_in">map</span>[j].y]) &#123;</div><div class="line">                        flag[<span class="built_in">map</span>[j].y] = <span class="literal">false</span>;</div><div class="line">                        d[(ed++) % n] = <span class="built_in">map</span>[j].y;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            flag[i] = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) &#123;</div><div class="line">        know[i] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=head[i]; j&gt;<span class="number">-1</span>; j=<span class="built_in">map</span>[j].next)</div><div class="line">            know[i] = max(know[i], dis[j][i]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> st = <span class="number">0</span>, ed = <span class="number">1</span>;</div><div class="line">    d[<span class="number">0</span>] = <span class="number">2</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) flag[i] = <span class="literal">true</span>;</div><div class="line">    flag[<span class="number">2</span>] = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) dis0[i] = <span class="number">9999999</span>;</div><div class="line">    dis0[<span class="number">2</span>] = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (st &lt; ed) &#123;</div><div class="line">        <span class="keyword">int</span> i = d[(st++) % n];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=head1[i]; j&gt;<span class="number">-1</span>; j=<span class="built_in">map</span>[j].next) &#123;</div><div class="line">            <span class="keyword">if</span> (dis0[<span class="built_in">map</span>[j].y] &gt; <span class="built_in">map</span>[j].w + dis0[i] &amp;&amp; dis0[<span class="built_in">map</span>[j].y] &gt; know[<span class="built_in">map</span>[j].y]) &#123;</div><div class="line">                dis0[<span class="built_in">map</span>[j].y] = max(<span class="built_in">map</span>[j].w + dis0[i], know[<span class="built_in">map</span>[j].y]);</div><div class="line">                <span class="keyword">if</span> (flag[<span class="built_in">map</span>[j].y]) &#123;</div><div class="line">                    flag[<span class="built_in">map</span>[j].y] = <span class="literal">false</span>;</div><div class="line">                    d[(ed++) % n] = <span class="built_in">map</span>[j].y;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        flag[i] = <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (dis0[<span class="number">1</span>] == <span class="number">9999999</span>) dis0[<span class="number">1</span>] = <span class="number">-1</span>;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, dis0[<span class="number">1</span>]);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1>打字机(typewriter)</h1>
<p><img src="http://gf.ppgame.com/CKFinderJava/1/files/1%20(1).png" alt="">
256MB 1seconds
【题目描述】
最近，小J在搬家的过程中发现了一台古老的打字机，好奇的小J决定研究如何使用它。
首先，需要将一条长度为m的纸带放入打字机。打字机上共有26个按键，分别是小写字母’a’-‘z’。每当你按下一个按键时，打字机就会立即在纸带上打印出那个字符，并将纸带平移一个单位距离。
聪明的小J很快就掌握了这款打字机的使用技巧，并尝试一些新的挑战。他拿出了一本字典，挑选了n个单词，并给每个单词设定了分数。纸带中每包含一次指定的单词，就会得到它对应的分数。例如单词’eye’分数为2，’year’分数为3，那么纸带’eyeyeyear’分数为9分。小J希望挑战自己，打出分数最高的纸带。
特别地，小J也会偶尔手抖，按到自己并不想输入的字符。由于这台古老的打字机没有退格（删除）功能，所以小J只能接受按错这个事实，重新规划他在按错的情况下如何得最高分。倘若小J有可能在任意位置按错按键，并保证整个过程中按错的次数不超过k次，那么请你算出他在最坏情况下的最高得分是多少。
【输入格式】
输入数据第一行包含3个非负整数n, m, k，分别表示单词数量、纸带长度和最多按错次数。
随后n行，每行包含一个字符串Si和正整数Ai，由空格隔开，描述这个单词及其得分。
【输出格式】
仅一行，包含一个整数，表示最坏情况下的最大得分。
【输入样例】
2 4 1
w 1
ha 9
【输出样例】
9
【样例说明】
首先，展示一种错误的思路：
共4种情况，即第1位按错、第2位按错、第3位按错和第4位按错。
1、第1位按错（不妨假设按成’x’，下同），最高得分为’xwha’，得分为10。
2、第2位按错，最高得分为’wxha’，同样为10分。
3、第3位按错，最高得分为’haxw’，同样为10分。
4、第4位按错，最高得分为’hawx’，同样为10分。
综上，最坏情况下最高得分为10分。
这种思路的错误之处在于，你不能根据哪一位按错决定你第一位按哪个键。换一种说法，你在哪一位按错，是要在你按下那一个按键之后才能知道的事情。所以正确的思路如下：
1、第1位先按’h’，倘若按对，goto2，倘若按错，goto4，
2、第2位按’a’，倘若按对，goto3，倘若按错，goto5，
3、第3位第4位均按’w’，至多错1次，最终的纸带为’hawx’或’haxw’，得分为10分。
4、由于已经错过1次，后面不会再错，后面三位按’haw’，最终的纸带为’xhaw’，得分为10分。
5、由于已经错过1次，后面不会再错，后面两位按’ha’，最终纸带为’hxha’，得分为9分。
综上，最坏情况下，最高得分为9分。
【数据规模与约定】
对于30%的数据，n=1；
另有30%的数据，k=0；
对于100%的数据，n&lt;=100，m&lt;=500，∑|Si|&lt;=500，Ai&lt;=1000，k&lt;=5。</p>
<h2>题解</h2>
<p>不愧是标准正解，不需要数据分治，我还是一只蒟蒻啊！！！！
数据三处分治。。有点怂。。。不过在线提交std却会超时，bzoj上我这道题是rank third！！！
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> res(i) for(register int i=0;i&lt;=cnt;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rez(i) for(register int i=1;i&lt;=26;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i,j) for(register int i=0;i&lt;j;i++)</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; </div><div class="line"><span class="keyword">char</span> s[<span class="number">510</span>];</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> di[<span class="number">210</span>][<span class="number">210</span>],ret[<span class="number">210</span>][<span class="number">210</span>],tmp[<span class="number">210</span>][<span class="number">210</span>],ans,M,P,tot;</div><div class="line"><span class="keyword">int</span> a[<span class="number">110</span>],ch[<span class="number">510</span>][<span class="number">27</span>],nxt[<span class="number">510</span>],la[<span class="number">510</span>],w[<span class="number">510</span>],cnt,q[<span class="number">510</span>],h,t,x,y,K,m,f[<span class="number">520</span>][<span class="number">520</span>][<span class="number">6</span>],n;</div><div class="line"><span class="keyword">bool</span> used[<span class="number">510</span>][<span class="number">510</span>][<span class="number">6</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">addnew</span><span class="params">(<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> now=<span class="number">0</span>,n=<span class="built_in">strlen</span>(s),x;</div><div class="line">    rep(i,n)&#123;</div><div class="line">        x=s[i]<span class="number">-96</span>;</div><div class="line">        <span class="keyword">if</span>(!ch[now][x])ch[now][x]=++cnt;</div><div class="line">        now=ch[now][x];</div><div class="line">    &#125;</div><div class="line">    w[now]+=v;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getnxt</span><span class="params">()</span></span>&#123;</div><div class="line">    h=<span class="number">1</span>;t=<span class="number">0</span>; </div><div class="line">    rez(i)<span class="keyword">if</span>(ch[<span class="number">0</span>][i])t++,q[t]=ch[<span class="number">0</span>][i]; </div><div class="line">    <span class="keyword">while</span>(h&lt;=t)&#123;</div><div class="line">        x=q[h++]; </div><div class="line">        rez(i)&#123;</div><div class="line">            <span class="keyword">int</span> j=ch[x][i]; </div><div class="line">            <span class="keyword">if</span>(!j)&#123;ch[x][i]=ch[nxt[x]][i];<span class="keyword">continue</span>;&#125; </div><div class="line">            y=nxt[x];</div><div class="line">            <span class="keyword">while</span>(y&amp;&amp;!ch[y][i])y=nxt[y]; </div><div class="line">            nxt[j]=ch[y][i];</div><div class="line">            w[j]+=w[nxt[j]]; </div><div class="line">            <span class="keyword">if</span>(w[nxt[j]])la[j]=nxt[j]; </div><div class="line">            <span class="keyword">else</span> la[j]=la[nxt[j]]; </div><div class="line">            q[++t]=j;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dp</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> x,<span class="keyword">int</span> k)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k&gt;K||used[n][x][k])<span class="keyword">return</span>;</div><div class="line">    used[n][x][k]=<span class="number">1</span>,f[n][x][k]=w[x];</div><div class="line">    <span class="keyword">if</span>(n==m)<span class="keyword">return</span>; </div><div class="line">    <span class="keyword">int</span> maxn=<span class="number">-707185547707185547</span>LL,maxb=<span class="number">0</span>; </div><div class="line">    rez(i)&#123;</div><div class="line">        dp(n+<span class="number">1</span>,ch[x][i],k); </div><div class="line">        <span class="keyword">if</span>(k&lt;K)dp(n+<span class="number">1</span>,ch[x][i],k+<span class="number">1</span>); </div><div class="line">        <span class="keyword">if</span>(f[n+<span class="number">1</span>][ch[x][i]][k]&gt;maxn)maxn=f[n+<span class="number">1</span>][ch[x][i]][k],maxb=i;</div><div class="line">    &#125;</div><div class="line">    maxn=<span class="number">707185547707185547L</span>L;</div><div class="line">    rez(i)<span class="keyword">if</span>(i==maxb)maxn=min(maxn,f[n+<span class="number">1</span>][ch[x][i]][k]);</div><div class="line">          <span class="keyword">else</span> <span class="keyword">if</span>(k&lt;K)maxn=min(maxn,f[n+<span class="number">1</span>][ch[x][i]][k+<span class="number">1</span>]);</div><div class="line">    f[n][x][k]+=maxn;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">slover</span><span class="params">(<span class="keyword">int</span> M,<span class="keyword">bool</span> chu)</span></span>&#123;</div><div class="line">    ans=<span class="number">0</span>;<span class="keyword">if</span>(chu)&#123; </div><div class="line">        <span class="built_in">memset</span>(di,<span class="number">0xef</span>,<span class="keyword">sizeof</span>(di)); </div><div class="line">		res(i)rez(j)di[i][ch[i][j]]=w[ch[i][j]]; </div><div class="line">        res(i)res(j)ret[i][j]=di[i][j];M--;</div><div class="line">        <span class="keyword">while</span>(M)&#123;</div><div class="line">            res(i)res(j)tmp[i][j]=<span class="number">-707185547707185547</span>LL; </div><div class="line">            <span class="keyword">if</span>(M&amp;<span class="number">1</span>)&#123;</div><div class="line">                res(i)res(k)res(j)tmp[i][j]=max(ret[i][k]+di[k][j],tmp[i][j]); </div><div class="line">                res(i)res(j)ret[i][j]=tmp[i][j]; </div><div class="line">            &#125; </div><div class="line">            res(i)res(j)tmp[i][j]=<span class="number">-707185547707185547</span>LL; </div><div class="line">            res(i)res(k)res(j)tmp[i][j]=max(tmp[i][j],di[i][k]+di[k][j]); </div><div class="line">            res(i)res(j)di[i][j]=tmp[i][j]; </div><div class="line">            M&gt;&gt;=<span class="number">1</span>;</div><div class="line">        &#125; </div><div class="line">        <span class="built_in">memset</span>(di,<span class="number">0xef</span>,<span class="keyword">sizeof</span>(di)); </div><div class="line">        res(i)rez(j)di[i][ch[i][j]]=w[ch[i][j]]; </div><div class="line">    &#125;<span class="keyword">else</span>&#123; </div><div class="line">        res(i)res(j)&#123; </div><div class="line">            tmp[i][j]=<span class="number">-707185547707185547</span>LL; </div><div class="line">            res(k)tmp[i][j]=max(ret[i][k]+di[k][j],tmp[i][j]); </div><div class="line">        &#125;</div><div class="line">        res(i)res(j)ret[i][j]=tmp[i][j]; </div><div class="line">    &#125; </div><div class="line">    res(i)ans=max(ans,ret[<span class="number">0</span>][i]); </div><div class="line">&#125; </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</div><div class="line">    M=m,P=M<span class="number">-300</span>,tot=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(;P&lt;=M<span class="number">-250</span>;P++)&#123;</div><div class="line">        rep(i,<span class="number">300</span>)res(j)rep(k,K+<span class="number">1</span>)used[i][j][k]=<span class="number">0</span>; </div><div class="line">        m=M-P;dp(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>); </div><div class="line">        slover(P,(P==M<span class="number">-300</span>)); </div><div class="line">        tot=max(tot,f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]+ans); </div><div class="line">    &#125; </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%lld"</span>,tot+<span class="number">1</span>); </div><div class="line">&#125; </div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readin</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> res,flag=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)res=ch<span class="number">-48</span>+res*<span class="number">10</span>;res*=flag;</div><div class="line">	<span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">//freopen(NAME".in","r",stdin);</span></div><div class="line">	<span class="comment">//freopen(NAME".out","w",stdout);</span></div><div class="line">	n=readin(),m=readin(),K=readin();</div><div class="line">    rep(i,n)<span class="built_in">scanf</span>(<span class="string">"%s"</span>,s),a[i+<span class="number">1</span>]=readin(),addnew(a[i+<span class="number">1</span>]);</div><div class="line">    getnxt();</div><div class="line">    <span class="keyword">if</span>(m&gt;<span class="number">500</span>&amp;&amp;K==<span class="number">0</span>&amp;&amp;cnt&lt;=<span class="number">200</span>)&#123;slover(m,<span class="number">1</span>);<span class="built_in">printf</span>(<span class="string">"%lld"</span>,ans);<span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">    <span class="keyword">if</span>(m&gt;<span class="number">500</span>&amp;&amp;K!=<span class="number">0</span>&amp;&amp;cnt&lt;=<span class="number">51</span>)&#123;work();<span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">    dp(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>,f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>标程
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> L = <span class="number">1010</span>, S=<span class="number">26</span>, M=<span class="number">1010</span>, INF = <span class="number">99999999</span>;</div><div class="line"><span class="keyword">struct</span> Node &#123;</div><div class="line">    Node * son[S];</div><div class="line">    Node * next;</div><div class="line">    <span class="keyword">int</span> value;</div><div class="line">&#125; node[L];</div><div class="line"><span class="keyword">int</span> n, m, k, x, num=<span class="number">0</span>;</div><div class="line"><span class="keyword">char</span> s[L];</div><div class="line"><span class="keyword">int</span> g1[L], g2[L];</div><div class="line"><span class="keyword">int</span> f1[L][<span class="number">11</span>], f2[L][<span class="number">11</span>];</div><div class="line">Node * root;</div><div class="line">Node * unknown = node;</div><div class="line"><span class="function">Node * <span class="title">new_node</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node * now = &amp;node[num++];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;S; k++)</div><div class="line">        now-&gt;son[k] = unknown;</div><div class="line">    now-&gt;next = unknown;</div><div class="line">    now-&gt;value = <span class="number">0</span>;</div><div class="line">    <span class="keyword">return</span> now;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">    unknown = new_node();</div><div class="line">    root = new_node();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;S; k++)</div><div class="line">        unknown-&gt;son[k] = root;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;k);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%s%d"</span>, s, &amp;x);</div><div class="line">        <span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</div><div class="line">        Node * now = root;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;len; j++) &#123;</div><div class="line">            <span class="keyword">if</span> (now-&gt;son[s[j]-<span class="string">'a'</span>] == unknown)</div><div class="line">                now-&gt;son[s[j]-<span class="string">'a'</span>] = new_node();</div><div class="line">            now = now-&gt;son[s[j]-<span class="string">'a'</span>];</div><div class="line">        &#125;</div><div class="line">        now-&gt;value += x;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/*</span></div><div class="line">    for (int i=0; i&lt;num; i++) &#123;</div><div class="line">        printf("before: node %d: son = [%d, %d, %d], next = %d, value = %d\n",</div><div class="line">                i, node[i].son[0] - node, node[i].son[1] - node, node[i].son[2] - node,</div><div class="line">                node[i].next - node, node[i].value);</div><div class="line">    &#125;</div><div class="line">    */</div><div class="line">    <span class="built_in">queue</span>&lt;Node *&gt; q;</div><div class="line">    q.push(root);</div><div class="line">    <span class="keyword">while</span> (!q.empty()) &#123;</div><div class="line">        Node * now = q.front();</div><div class="line">        q.pop();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;S; k++)</div><div class="line">            <span class="keyword">if</span> (now-&gt;son[k] != unknown) &#123;</div><div class="line">                now-&gt;son[k]-&gt;next = now-&gt;next-&gt;son[k];</div><div class="line">                now-&gt;son[k]-&gt;value += now-&gt;next-&gt;son[k]-&gt;value;</div><div class="line">                q.push(now-&gt;son[k]);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                now-&gt;son[k] = now-&gt;next-&gt;son[k];</div><div class="line">            &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/*</span></div><div class="line">    for (int i=0; i&lt;num; i++) &#123;</div><div class="line">        printf("after: node %d: son = [%d, %d, %d], next = %d, value = %d\n",</div><div class="line">                i, node[i].son[0] - node, node[i].son[1] - node, node[i].son[2] - node,</div><div class="line">                node[i].next - node, node[i].value);</div><div class="line">    &#125;</div><div class="line">    */</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve_without_k</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">        g1[j] = node[j].value;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=m<span class="number">-1</span>; i&gt;=<span class="number">0</span>; i--) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            g2[j] = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> c=<span class="number">0</span>; c&lt;S; c++) &#123;</div><div class="line">                <span class="keyword">int</span> t = node[j].son[c] - node;</div><div class="line">                g2[j] = max(g2[j], g1[t] + node[j].value);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//printf("g[%d][%d] = %d\n", i, j, g2[j]);</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            g1[j] = g2[j];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, g2[root-node]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            f1[j][<span class="number">0</span>] = node[j].value;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> r=<span class="number">1</span>; r&lt;=k; r++) &#123;</div><div class="line">            f1[j][r] = -INF;</div><div class="line">            f1[j][r] = node[j].value;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=m<span class="number">-1</span>; i&gt;=<span class="number">0</span>; i--) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> r=<span class="number">0</span>; r&lt;=k; r++) &#123;</div><div class="line">                f2[j][r] = -INF;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> c=<span class="number">0</span>; c&lt;S; c++) &#123;</div><div class="line">                    <span class="keyword">int</span> t = node[j].son[c] - node;</div><div class="line">                    f2[j][r] = max(f2[j][r], f1[t][r] + node[j].value);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (r &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> c=<span class="number">0</span>; c&lt;S; c++) &#123;</div><div class="line">                        <span class="keyword">int</span> t = node[j].son[c] - node;</div><div class="line">                        f2[j][r] = min(f2[j][r], f1[t][r<span class="number">-1</span>] + node[j].value);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//printf("g[%d][%d][%d] = %d\n", i, j, r, f2[j][r]);</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> r=<span class="number">0</span>; r&lt;=k; r++) &#123;</div><div class="line">                f1[j][r] = f2[j][r];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, f2[root-node][k]);</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</div><div class="line">	freopen(<span class="string">"typewriter.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"typewriter.ans"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">    init();</div><div class="line">    build();</div><div class="line">    <span class="comment">//solve_without_k();</span></div><div class="line">    solve();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

  </section>

  <!-- ������City�氲װ���� -->
<div id="lv-container" data-id="city" data-uid="MTAyMC8zNzc0Ni8xNDI3Nw==">
	<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
	</script>
<noscript> Ϊ����ʹ�����������۹����뼤��JavaScript</noscript>
</div>
<!-- City�氲װ���������� -->
<a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=846938219&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:846938219:51" alt="click it and link me" title="click it and link me"/></a>


</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
    
</footer>
        </div>
    </div>
    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    
	
    

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)'], ['$','$']]} 
            });
        });
    </script>
	<script type="text/javascript" src="http://latex.codecogs.com/editor3.js"></script>
	<p><a href="javascript:OpenLatexEditor('testbox','html','')">
	Launch CodeCogs Equation Editor
	</a></p>
	<textarea id="testbox" rows="3" cols="40"></textarea>

    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    <script src="https://s13.cnzz.com/z_stat.php?id=1274126632&web_id=1274126632" language="JavaScript"></script>

    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]--><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

</body>
</html>
